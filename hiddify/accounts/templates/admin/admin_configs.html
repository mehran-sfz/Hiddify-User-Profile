<!DOCTYPE html>
<html lang="fa" dir="rtl">
  {% load static %}
  {% load custom_filters %}

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ادمین - کانفیگ ها</title>
    <link
      rel="shortcut icon"
      href="{% static 'logo/batman_logo_y.png' %}"
      type="image/x-icon"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <link href="{% static 'css/admin.css' %}" rel="stylesheet" />
  </head>

  <body class="p-4" style="overflow-y: auto">
    {% include "includes/alert.html" %}
    {% include "includes/admin/navigation.html" %}

    <section id="ordersTable" class="ftco-section">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-12">
            <div class="table-wrap table-responsive">
              <table class="table table-hover custom-table">
                <h2>کانفیگ ها</h2>

                <form method="get" action="{% url 'admin-panel-configs' %}">
                  <div class="form-group">
                    <select class="form-control col-md-3 mb-2" name="filter" onchange="this.form.submit()">
                        <option value="all" {% if not filter or filter == 'all' %}selected{% endif %}>همه</option>
                        <option value="active" {% if filter == 'active' %}selected{% endif %}>فعال</option>
                        <option value="inactive" {% if filter == 'inactive' %}selected{% endif %}>غیرفعال</option>
                        <option value="package_ended" {% if filter == 'package_ended' %}selected{% endif %}>تمام شده</option>
                    </select> 
                  </div> 
                </form>

                <thead>
                  <tr>
                    <th>نام</th>
                    <th>وضعیت</th>
                    <th>uuid</th>
                    <th>تاریخ شروع</th>
                    <th>مدت زمان</th>
                    <th>ترافیک</th>
                    <th>گزینه‌ها</th>
                  </tr>
                </thead>
                <tbody>
                  {% for config in page_obj %}
                  <tr>
                    <td>{{ config.name }}</td>

                    <td>
                        {% if config.enable == True and config.is_active == True %}
                        <span class="badge bg-success">فعال</span>

                        {% elif config.enable == True and config.is_active == False %}
                        <span class="badge bg-warning">تمام شده</span>

                        {% else %}
                        <span class="badge bg-danger">غیرفعال</span>
                        
                        {% endif %}
                      </td>

                    <td>{{ config.uuid }}</td>

                    
                    {% if config.start_date %}
                    <td>{{ config.start_date|to_jalali }}</td>
                    {% else %}
                    <td>
                      <span class="badge bg-warning">استفاده نشده</span>
                    </td>
                    {% endif %}

                    <td>{{ config.package_days }}</td>
                    <td>{{ config.usage_limit_GB }}</td>
                    <td>
                    <form action="{% url 'admin-panel-configs' %}" method="POST" class="confirmable-form">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="on_off" />
                        <input type="hidden" name="hidify_user_uuid" value="{{ config.uuid }}" />
                        <input type="hidden" name="page" value="{{ page_obj.number }}">
                        <input type="hidden" name="filter" value="{{ filter|default:'all' }}">
                        <button class="btn btn-outline-danger" type="button" onclick="showConfirmModal(this);">
                            فعال/غیرفعال
                        </button>
                    </form>
                    </td>
                  </tr>

                  {% endfor %}
                </tbody>
              </table>

                <div class="d-flex justify-content-center mt-4">
                    {% if page_obj.has_other_pages %}
                    <nav aria-label="Page navigation">
                      <ul class="pagination">
                  
                        {% if page_obj.has_previous %}
                          <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if filter %}&filter={{ filter }}{% endif %}" aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                            </a>
                          </li>
                        {% else %}
                          <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true" aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                            </a>
                          </li>
                        {% endif %}
                  
                        {% for i in page_obj.paginator.page_range %}
                          {% if page_obj.number == i %}
                            <li class="page-item active" aria-current="page">
                              <span class="page-link">{{ i }}</span>
                            </li>
                          {% elif i > page_obj.number|add:'-3' and i < page_obj.number|add:'3' %}
                            <li class="page-item">
                              <a class="page-link" href="?page={{ i }}{% if filter %}&filter={{ filter }}{% endif %}">{{ i }}</a>
                            </li>
                          {% endif %}
                        {% endfor %}
                  
                        {% if page_obj.has_next %}
                          <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if filter %}&filter={{ filter }}{% endif %}" aria-label="Next">
                              <span aria-hidden="true">&raquo;</span>
                            </a>
                          </li>
                        {% else %}
                          <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true" aria-label="Next">
                              <span aria-hidden="true">&raquo;</span>
                            </a>
                          </li>
                        {% endif %}
                  
                      </ul>
                    </nav>
                    {% endif %}
                  </div>
            </div>
          </div>
        </div>
      </div>
    </section>





    <div class="modal fade" id="confirmActionModal" tabindex="-1" aria-labelledby="confirmActionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmActionModalLabel">تایید عملیات</h5>
                </div>
                <div class="modal-body">
                    آیا از انجام این عملیات اطمینان دارید؟
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">لغو</button>
                    <button type="button" class="btn btn-danger" id="confirmActionButton">بله، مطمئنم</button>
                </div>
            </div>
        </div>
    </div>
    {% include "includes/footer.html" %}

  </body>
</html>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/script.js' %}"></script>

<style>
  /* Custom CSS for spacing */
  .navbar-nav .nav-item {
    margin-right: 15px; /* Spacing for large screens */
  }

  /* For small screens (max-width: 768px) */
  @media (max-width: 768px) {
    .navbar-nav .nav-item {
      margin-right: 10px; /* Adjust spacing for small screens */
      margin-bottom: 10px; /* Add vertical space for stacked buttons */
    }
  }
</style>


<script>
    let formToSubmit = null;

    function showConfirmModal(button) {
        // Find the closest form to the clicked button
        formToSubmit = button.closest('form');
        // Show the modal
        const confirmModal = new bootstrap.Modal(document.getElementById('confirmActionModal'));
        confirmModal.show();
    }

    // Confirm button in the modal
    document.getElementById('confirmActionButton').addEventListener('click', function () {
        if (formToSubmit) {
            // Hide the modal first
            const confirmModal = bootstrap.Modal.getInstance(document.getElementById('confirmActionModal'));
            confirmModal.hide();

            // Submit the form after hiding the modal
            formToSubmit.submit();
        }
    });
</script>