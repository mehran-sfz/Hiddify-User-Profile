<!DOCTYPE html>
<html lang="fa" dir="rtl">
  {% load static %}
  {% load custom_filters %}
  
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="{% static 'logo/batman_logo_y.png' %}" type="image/x-icon">
    
    <title>ورود و ثبت نام</title>

    <!-- Bootstrap CSS using CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    
    <!-- Custom CSS -->
    <link href="{% static 'css/login.css' %}" rel="stylesheet" />

  </head>
  
  <body class="d-flex justify-content-center align-items-center min-vh-100 p-4" style="overflow-y: auto;">
    <div class="form-container bg-white rounded-lg shadow-lg p-4">

      <!-- Login Section -->
      <div id="login-section">
        <button
          class="btn btn-outline-primary w-100 mb-3 py-2"
          onclick="toggleSection()"
        >
          ثبت نام
        </button>

        <h2 class="text-center mb-4 fs-4">ورود</h2>
        <form id="login-form" action="{% url 'register' %}" method="POST">
          {% csrf_token %}

          <!-- Hidden field to pass form ID -->
          <input type="hidden" id="form_id" name="form_id" value="login-form" />

          <div class="mb-3">
            <label for="email" class="form-label text-end w-100">
              ایمیل<span class="text-danger">*</span>
            </label>
            <input
              type="text"
              id="email"
              name="email"
              class="form-control form-control-lg text-end"
              placeholder="email@example.com"
              required
            />
          </div>
          <div class="mb-3">
            <label for="password" class="form-label text-end w-100">رمز<span class="text-danger">*</span>
            </label>
            <input
              type="password"
              id="password"
              name="password"
              class="form-control form-control-lg text-end"
              placeholder="رمز"
              required
            />
          </div>
          <button type="submit" class="btn btn-success w-100 py-2">ورود</button>
        </form>
      </div>

      <!-- Register Section -->
      <div id="register-section" class="d-none">
        <button
          class="btn btn-outline-primary w-100 mb-3 py-2"
          onclick="toggleSection()"
        >
          ورود
        </button>

        <h2 class="text-center mb-4 fs-4">ثبت نام</h2>
        <form id="register-form" action="{% url 'register' %}" method="POST">
          {% csrf_token %}

          <!-- Hidden field to pass form ID -->
          <input type="hidden" name="form_id" value="register-form" />

          <div class="mb-3">
            <label for="name" class="form-label text-end w-100">نام</label>
            <input
              type="text"
              id="name"
              name="name"
              class="form-control form-control-lg text-end"
              placeholder="نام"
            />
          </div>
          <div class="mb-3">
            <label for="family" class="form-label text-end w-100"
              >نام خانوادگی</label
            >
            <input
              type="text"
              id="family"
              name="family"
              class="form-control form-control-lg text-end"
              placeholder="نام خانوادگی"
            />
          </div>
          <div class="mb-3">
            <label for="register-email" class="form-label text-end w-100"
              >ایمیل<span class="text-danger">*</span>
            </label>
            <input
              type="text"
              id="register-email"
              name="email"
              class="form-control form-control-lg text-end"
              placeholder="email@example.com"
              required
            />
          </div>
          <div class="mb-3">
            <label for="register-password" class="form-label text-end w-100">رمز
              <span class="text-danger">*</span>
            </label>
            <input
              type="password"
              id="register-password"
              name="password"
              class="form-control form-control-lg text-end"
              placeholder="رمز"
              required
            />
          </div>
          <div class="mb-3">
            <label for="confirm-password" class="form-label text-end w-100">تکرار رمز
              <span class="text-danger">*</span>
            </label>
            <input
              type="password"
              id="confirm-password"
              name="confirm_password"
              class="form-control form-control-lg text-end"
              placeholder="تکرار رمز"
              required
            />
          </div>
          <div class="mb-3">
            <label for="invite-code" class="form-label text-end w-100"
              >کد دعوت</label
            >
            <input
              type="text"
              id="invite-code"
              name="invite_code"
              class="form-control form-control-lg text-end"
              placeholder="کد دعوت"
            />
          </div>
          <button type="submit" class="btn btn-success w-100 py-2">
            ثبت نام
          </button>
        </form>
      </div>
    </div>
    
    {% include "includes/footer.html" %}
    {% include "includes/alert.html" %}
   </body>
</html>

<!-- Toggle Section -->
<script>
    let isLogin = true;
    function toggleSection() {
      const loginSection = document.getElementById("login-section");
      const registerSection = document.getElementById("register-section");
      isLogin = !isLogin;

      if (isLogin) {
        loginSection.classList.remove("d-none");
        registerSection.classList.add("d-none");
      } else {
        loginSection.classList.add("d-none");
        registerSection.classList.remove("d-none");
      }
    }
</script>



  <!-- Bootstrap JS (for alert close button functionality) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Alert Box -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  // تمام المان‌های alert را که مخفی هستند پیدا کن
  const alertBoxes = document.querySelectorAll(".popup-alert.d-none");

  // مدت زمانی که هر پیام نمایش داده می‌شود (5 ثانیه)
  const displayDuration = 5000;
  
  // فاصله زمانی بین نمایش هر پیام (مثلاً دو ثانیه)
  const staggerDelay = 2000;

  // به ازای هر alert یک عملیات زمان‌بندی شده انجام بده
  alertBoxes.forEach((alertBox, index) => {
    
    // محاسبه تاخیر برای نمایش این پیام بر اساس ترتیب آن
    // پیام اول: 0 * 500 = 0 میلی‌ثانیه تاخیر
    // پیام دوم: 1 * 500 = 500 میلی‌ثانیه تاخیر
    // و الی آخر...
    const showDelay = index * staggerDelay;

    // یک تایمر برای نمایش پیام تنظیم کن
    setTimeout(() => {
      // کلاس d-none را حذف کن تا پیام با افکت fade نمایش داده شود
      alertBox.classList.remove("d-none");

      // حالا که پیام نمایش داده شد، یک تایمر دیگر برای بستن آن تنظیم کن
      setTimeout(() => {
        // از API خود بوت‌استرپ برای بستن استفاده کن تا افکت fade-out اجرا شود
        const bsAlert = new bootstrap.Alert(alertBox);
        if (bsAlert) {
          bsAlert.close();
        }
      }, displayDuration); // این تایمر ۲ ثانیه بعد از نمایش، اجرا می‌شود

    }, showDelay); // این تایمر با تاخیر محاسبه‌شده اجرا می‌شود
  });
});
</script>
